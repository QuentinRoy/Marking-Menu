{"version":3,"file":"marking-menu.js","sources":["src/utils.js","src/move/pointer-events.js","src/move/linear-drag.js","src/move/long-move.js","src/move/dwelling.js","src/move/draw.js","src/navigation/novice-navigation.js","src/recognizer/find-points.js","src/recognizer/articulation-points.js","src/recognizer/stroke-length.js","src/recognizer/recognize-mm-stroke.js","src/navigation/expert-navigation.js","src/navigation/navigation.js","node_modules/style-inject/dist/style-inject.es.js","src/layout/menu.js","src/layout/stroke.js","node_modules/raf-schd/dist/raf-schd.esm.js","src/layout/connect.js","src/layout/gesture-feedback.js","src/model.js","src/main.js"],"sourcesContent":["/**\n * @param {number} a the dividend\n * @param {number} n the divisor\n * @return {number} The modulo of `a` over `n` (% is not exactly modulo but remainder).\n */\nexport const mod = (a, n) => ((a % n) + n) % n;\n\n/**\n * @param {number} radians an angle in radians\n * @return {number} The angle in degrees.\n */\nexport const radiansToDegrees = (radians) => radians * (180 / Math.PI);\n\n/**\n * @param {number} degrees an angle in degrees\n * @return {number} The angle in radians.\n */\nexport const degreesToRadians = (degrees) => degrees * (Math.PI / 180);\n\n/**\n * @param {number} alpha a first angle (in degrees)\n * @param {number} beta a second angle (in degrees)\n * @return {number} The (signed) delta between the two angles (in degrees).\n */\nexport const deltaAngle = (alpha, beta) => mod(beta - alpha + 180, 360) - 180;\n\n/**\n * Calculate the euclidean distance between two\n * points.\n *\n * @param {List<number>} point1 - The first point\n * @param {List<number>} point2 - The second point\n * @return {number} The distance between the two points.\n */\nexport const dist = (point1, point2) => {\n  const sum = point1.reduce((acc, x1i, i) => {\n    const x2i = point2[i];\n    return acc + (x2i - x1i) ** 2;\n  }, 0);\n  return Math.sqrt(sum);\n};\n\nconst ANGLE_ROUNDING = 10e-8;\n/**\n * @param {number[]} a - The first point.\n * @param {number[]} b - The second point, center of the angle.\n * @param {number[]} c - The third point.\n * @return {number} The angle abc (in degrees) rounded at the 8th decimal.\n */\nexport const angle = (a, b, c) => {\n  const lab = dist(a, b);\n  const lbc = dist(b, c);\n  const lac = dist(a, c);\n  const cos = (lab ** 2 + lbc ** 2 - lac ** 2) / (2 * lab * lbc);\n  // Due to rounding, it can happen than cos ends up being slight > 1 or slightly < -1.\n  // This fixes it.\n  const adjustedCos = Math.max(-1, Math.min(1, cos));\n  const angleABC = radiansToDegrees(Math.acos(adjustedCos));\n  // Round the angle to avoid rounding issues.\n  return Math.round(angleABC / ANGLE_ROUNDING) * ANGLE_ROUNDING;\n};\n\n/**\n * @callback findMaxEntryComp\n * @param {*} item1 - A first item.\n * @param {*} item2 - A second item.\n * @return {number} A positive number if the second item should be ranked higher than the first,\n *                  a negative number if it should be ranked lower and 0 if they should be ranked\n *                  the same.\n */\n\n/**\n * @param {List} list - A list of items.\n * @param {findMaxEntryComp} comp - A function to calculate a value from an item.\n * @return {[index, item]} The found entry.\n */\nexport const findMaxEntry = (list, comp) =>\n  list.slice(0).reduce(\n    (result, item, index) => {\n      if (comp(result[1], item) > 1) return [index, item];\n      return result;\n    },\n    [0, list[0]]\n  );\n\n/**\n * Converts the coordinates of a point in polar coordinates (angle in degrees).\n *\n * @param  {number[]} point - A point.\n * @param  {number[]} [pole=[0, 0]] - The pole of a polar coordinate\n *                                    system\n * @return {{azymuth, radius}} The angle coordinate of the point in the polar\n *                             coordinate system in degrees.\n */\nexport const toPolar = ([px, py], [cx, cy] = [0, 0]) => {\n  const x = px - cx;\n  const y = py - cy;\n  return {\n    azymuth: radiansToDegrees(Math.atan2(y, x)),\n    radius: Math.sqrt(x * x + y * y),\n  };\n};\n","// Create a custom pointer event from a touch event.\nexport const createPEventFromTouchEvent = (touchEvt) => {\n  const touchList = Array.from(touchEvt.targetTouches);\n  const sumX = touchList.reduce((acc, t) => acc + t.clientX, 0);\n  const sumY = touchList.reduce((acc, t) => acc + t.clientY, 0);\n  const meanX = sumX / touchList.length;\n  const meanY = sumY / touchList.length;\n  return {\n    originalEvent: touchEvt,\n    position: [meanX, meanY],\n    timeStamp: touchEvt.timeStamp,\n  };\n};\n\n// Create a custom pointer from a mouse event.\nexport const createPEventFromMouseEvent = (mouseEvt) => ({\n  originalEvent: mouseEvt,\n  position: [mouseEvt.clientX, mouseEvt.clientY],\n  timeStamp: mouseEvt.timeStamp,\n});\n","import { fromEvent, of, merge } from 'rxjs';\nimport {\n  map,\n  takeUntil,\n  publishBehavior,\n  filter,\n  startWith,\n} from 'rxjs/operators';\nimport {\n  createPEventFromMouseEvent,\n  createPEventFromTouchEvent,\n} from './pointer-events';\n\n// Higher order observable tracking mouse drags.\nexport const mouseDrags = (rootDOM) =>\n  fromEvent(rootDOM, 'mousedown').pipe(\n    map((downEvt) => {\n      // Make sure we include the first mouse down event.\n      const drag$ = merge(of(downEvt), fromEvent(rootDOM, 'mousemove')).pipe(\n        takeUntil(fromEvent(rootDOM, 'mouseup')),\n        // Publish it as a behavior so that any new subscription will\n        // get the last drag position.\n        publishBehavior()\n      );\n      drag$.connect();\n      return drag$;\n    }),\n    map((o) => o.pipe(map((...args) => createPEventFromMouseEvent(...args))))\n  );\n\n// Higher order observable tracking touch drags.\nexport const touchDrags = (rootDOM) =>\n  fromEvent(rootDOM, 'touchstart').pipe(\n    // Menu is supposed to have pointer-events: none so we can safely rely on\n    // targetTouches.\n    filter((evt) => evt.targetTouches.length === 1),\n    map((firstEvent) => {\n      const drag$ = fromEvent(rootDOM, 'touchmove').pipe(\n        startWith(firstEvent),\n        takeUntil(\n          merge(\n            fromEvent(rootDOM, 'touchend'),\n            fromEvent(rootDOM, 'touchcancel'),\n            fromEvent(rootDOM, 'touchstart')\n          ).pipe(filter((evt) => evt.targetTouches.length !== 1))\n        ),\n        publishBehavior()\n      );\n      // FIXME: the line below retains the subscription until next touch end.\n      drag$.connect();\n      return drag$;\n    }),\n    map((o) => o.pipe(map(createPEventFromTouchEvent)))\n  );\n\n/**\n * @param {HTMLElement} rootDOM - the DOM element to observe pointer events on.\n * @return {Observable} A higher order observable that drag observables. The sub-observables are\n *                      published as behaviors so that any new subscription immediately get the last\n *                      position.\n * @param {function[]} [dragObsFactories] - factory to use to observe drags.\n */\nconst watchDrags = (rootDOM, dragObsFactories = [touchDrags, mouseDrags]) =>\n  merge(...dragObsFactories.map((f) => f(rootDOM)));\n\nexport default watchDrags;\n","import { scan, filter, map } from 'rxjs/operators';\nimport { dist } from '../utils';\n\n/**\n * Filter out small movements out of a drag observable.\n * @param {Observable} drag$ - An observable on drag movements.\n * @param {number} movementsThreshold - The threshold below which movements are considered\n *                                      static.\n * @return {Observable} An observable only emitting on long enough movements.\n */\nexport default (drag$, movementsThreshold = 0) =>\n  drag$.pipe(\n    scan(([prev], cur) => {\n      // Initial value.\n      if (prev == null) return [cur, false];\n\n      // End of drag can never be a long move. Such events aren't supposed to be\n      // emitted by drag observable though.\n      if (cur.type === 'end' || cur.type === 'cancel') return [cur, false];\n\n      // If the distance is still below the threshold, re-emit the previous\n      // event. It will be filtered-out later, but will come back again as\n      // prev on the next scan call.\n      if (dist(prev.position, cur.position) < movementsThreshold)\n        return [prev, false];\n\n      // Otherwise, emit the new event.\n      return [cur, true];\n    }, []),\n    filter(([, pass]) => pass),\n    map((x) => x[0])\n  );\n","import { merge } from 'rxjs';\nimport {\n  debounceTime,\n  takeUntil,\n  first,\n  withLatestFrom,\n  last,\n} from 'rxjs/operators';\nimport longMoves from './long-move';\n\n/**\n * @param {Observable} drag$ - An observable on drag movements.\n * @param {number} delay - The time (in ms) to wait before considering an absence of movements\n *                         as a dwell.\n * @param {number} [movementsThreshold=0] - The threshold below which movements are considered\n *                                          static.\n * @param {Scheduler} [scheduler] - The scheduler to use for managing the timers that handle the timeout\n * for each value\n * @return {Observable} An observable on dwellings in the movement.\n */\nexport default (drag$, delay, movementsThreshold = 0, scheduler = undefined) =>\n  merge(drag$.pipe(first()), longMoves(drag$, movementsThreshold)).pipe(\n    // Emit when no long movements happend for delay time.\n    debounceTime(delay, scheduler),\n    // debounceTime emits the last item when the source observable completes.\n    // We don't want that here so we only take until drag is done.\n    takeUntil(drag$.pipe(last())),\n    // Make sure we do emit the last position.\n    withLatestFrom(drag$, (_, last_) => last_)\n  );\n","import { scan } from 'rxjs/operators';\n\n/**\n * Augment a drag$ observable so that events also include the stroke.\n * @param {Observable} drag$ - An observable of drag movements.\n * @param {List<number[]>} initStroke - Initial stroke.\n * @return {Observable} An observable on the gesture drawing.\n */\nexport default (drag$, { initStroke = [], type = undefined }) => {\n  const typeOpts = type === undefined ? {} : { type };\n  return drag$.pipe(\n    scan(\n      (acc, notification) => ({\n        stroke: [...acc.stroke, notification.position],\n        ...typeOpts,\n        ...notification,\n      }),\n      { stroke: initStroke }\n    )\n  );\n};\n","import { merge } from 'rxjs';\nimport {\n  scan,\n  startWith,\n  share,\n  last,\n  map,\n  filter,\n  switchAll,\n  take,\n} from 'rxjs/operators';\nimport { toPolar } from '../utils';\nimport { dwellings } from '../move';\n\nexport const noviceMoves = (drag$, menu, { menuCenter, minSelectionDist }) => {\n  // Analyse local movements.\n  const moves$ = drag$.pipe(\n    scan(\n      (last_, n) => {\n        const { azymuth, radius } = toPolar(n.position, menuCenter);\n        const active =\n          radius < minSelectionDist ? null : menu.getNearestChild(azymuth);\n        const type = last_.active === active ? 'move' : 'change';\n        return { active, type, azymuth, radius, ...n };\n      },\n      { active: null }\n    ),\n    startWith({\n      type: 'open',\n      menu,\n      center: menuCenter,\n      timeStamp: performance ? performance.now() : Date.now(),\n    }),\n    share()\n  );\n\n  const end$ = moves$.pipe(\n    startWith({}),\n    last(),\n    map((n) => ({\n      ...n,\n      type: n.active && n.active.isLeaf() ? 'select' : 'cancel',\n      selection: n.active,\n    }))\n  );\n\n  return merge(moves$, end$).pipe(share());\n};\n\nexport const menuSelection = (\n  move$,\n  { subMenuOpeningDelay, movementsThreshold, minMenuSelectionDist }\n) =>\n  // Wait for a pause in the movements.\n  dwellings(move$, subMenuOpeningDelay, movementsThreshold).pipe(\n    // Filter dwellings occurring outside of the selection area.\n    filter(\n      (n) => n.active && n.radius > minMenuSelectionDist && !n.active.isLeaf()\n    )\n  );\n\nexport const subMenuNavigation = (menuSelection$, drag$, subNav, navOptions) =>\n  menuSelection$.pipe(\n    map((n) =>\n      subNav(drag$, n.active, { menuCenter: n.position, ...navOptions })\n    )\n  );\n\n/**\n * @param {Observable} drag$ - An observable of drag movements.\n * @param {MMItem} menu - The model of the menu.\n * @param {object} options - Configuration options.\n * @return {Observable} An observable on the menu navigation events.\n */\nconst noviceNavigation = (\n  drag$,\n  menu,\n  {\n    minSelectionDist,\n    minMenuSelectionDist,\n    movementsThreshold,\n    subMenuOpeningDelay,\n    menuCenter,\n    noviceMoves: noviceMoves_ = noviceMoves,\n    menuSelection: menuSelection_ = menuSelection,\n    subMenuNavigation: subMenuNavigation_ = subMenuNavigation,\n  }\n) => {\n  // Observe the local navigation.\n  const move$ = noviceMoves_(drag$, menu, {\n    menuCenter,\n    minSelectionDist,\n  }).pipe(share());\n\n  // Look for (sub)menu selection.\n  const menuSelection$ = menuSelection_(move$, {\n    subMenuOpeningDelay,\n    movementsThreshold,\n    minMenuSelectionDist,\n  });\n\n  // Higher order observable on navigation inside sub-menus.\n  const subMenuNavigation$ = subMenuNavigation_(\n    menuSelection$,\n    drag$,\n    noviceNavigation,\n    {\n      minSelectionDist,\n      minMenuSelectionDist,\n      movementsThreshold,\n      subMenuOpeningDelay,\n      noviceMoves: noviceMoves_,\n      menuSelection: menuSelection_,\n      subMenuNavigation: subMenuNavigation_,\n    }\n  );\n\n  // Start with local navigation but switch to the first sub-menu navigation\n  // (if any).\n  return subMenuNavigation$.pipe(take(1), startWith(move$), switchAll());\n};\n\nexport default noviceNavigation;\n","import { dist, angle } from '../utils';\n\n/**\n * @param {Array.<number[]>} pointList - The list of points.\n * @param {number} minDist - A distance.\n * @param {object} options - Options.\n * @param {number} [options.direction=1] - The direction of the lookup: negative values means\n *                                         descending lookup.\n * @param {number} [options.startIndex] - The index of the first point to investigate inside\n *                                        pointList. If not provided, the lookup will start\n *                                        from the start or the end of pointList depending\n *                                        on `direction`.\n * @param {number[]} [options.refPoint=pointList[startIndex]] - The reference point.\n * @return {number} The index of the first point inside pointList that it at least `minDist` from\n *                  `refPoint`.\n */\nexport const findNextPointFurtherThan = (\n  pointList,\n  minDist,\n  {\n    direction = 1,\n    startIndex = direction > 0 ? 0 : pointList.length - 1,\n    refPoint = pointList[startIndex],\n  } = {}\n) => {\n  const step = direction / Math.abs(direction);\n  const n = pointList.length;\n  for (let i = startIndex; i < n && i >= 0; i += step) {\n    if (dist(refPoint, pointList[i]) >= minDist) {\n      return i;\n    }\n  }\n  return -1;\n};\n\n/**\n * @param {number[]} pointA - The point a.\n * @param {number[]} pointC - The point b.\n * @param {List.<number[]>} pointList - A list of points.\n * @param {number[]} options - Options.\n * @param {number} [options.startIndex=0] - The index of the first point to investigate inside\n *                                          pointList.\n * @param {number} [options.endIndex=pointList.length - 1] - The index of the first point to\n *                                                           investigate inside pointList.\n * @return {{index, angle}} The index of the point b of pointList that maximizes the angle abc and\n *                          the angle abc.\n */\nexport const findMiddlePointForMinAngle = (\n  pointA,\n  pointC,\n  pointList,\n  { startIndex = 0, endIndex = pointList.length - 1 } = {}\n) => {\n  let minAngle = Infinity;\n  let maxAngleIndex = -1;\n  for (let i = startIndex; i <= endIndex; i += 1) {\n    const thisAngle = angle(pointA, pointList[i], pointC);\n    if (thisAngle < minAngle) {\n      minAngle = thisAngle;\n      maxAngleIndex = i;\n    }\n  }\n  return { index: maxAngleIndex, angle: minAngle };\n};\n","import {\n  findNextPointFurtherThan,\n  findMiddlePointForMinAngle,\n} from './find-points';\n\n/**\n * @typedef {number[]} Point\n */\n\n/**\n * A segment.\n * @typedef {Point[2]} Segment\n */\n\n/**\n * @param {Point[]} stroke - The points of a stroke.\n * @param {number} expectedSegmentLength - The expected length of a segment\n *                                         (usually strokeLength / maxMenuDepth).\n * @param {number} angleThreshold - The min angle threshold in a point required for it to be\n *                                  considered an articulation points.\n * @return {Point[]} The list of articulation points.\n */\nconst getStrokeArticulationPoints = (\n  stroke,\n  expectedSegmentLength,\n  angleThreshold\n) => {\n  const n = stroke.length;\n  if (n === 0) return [];\n  const w = expectedSegmentLength * 0.3;\n\n  // Add the first point of the stroke.\n  const articulationPoints = [stroke[0]];\n\n  let ai = 0;\n  let a = stroke[ai];\n  while (ai < n) {\n    const ci = findNextPointFurtherThan(stroke, w, {\n      startIndex: ai + 2,\n      refPoint: a,\n    });\n    if (ci < 0) break;\n    const c = stroke[ci];\n    const labi = findNextPointFurtherThan(stroke, w / 8, {\n      startIndex: ai + 1,\n      refPoint: a,\n    });\n    const lbci = findNextPointFurtherThan(stroke, w / 8, {\n      startIndex: ci - 1,\n      refPoint: c,\n      direction: -1,\n    });\n    const { index: bi, angle: angleABC } = findMiddlePointForMinAngle(\n      a,\n      stroke[ci],\n      stroke,\n      {\n        startIndex: labi,\n        endIndex: lbci,\n      }\n    );\n    if (bi > 0 && Math.abs(180 - angleABC) > angleThreshold) {\n      const b = stroke[bi];\n      articulationPoints.push(b);\n      a = b;\n      ai = bi;\n    } else {\n      ai += 1;\n      a = stroke[ai];\n    }\n  }\n\n  // Add the last point of the stroke.\n  articulationPoints.push(stroke[stroke.length - 1]);\n  return articulationPoints;\n};\n\nexport default getStrokeArticulationPoints;\n","import { dist } from '../utils';\n\n/**\n * @param {List<List<number>>} stroke - A stroke.\n * @return {number} The length of the stroke `stroke`.\n */\nexport default (stroke) =>\n  stroke.reduce(\n    (res, current) => {\n      const prev = res.prev || current;\n      return {\n        prev: current,\n        length: res.length + dist(prev, current),\n      };\n    },\n    { length: 0 }\n  ).length;\n","import getStrokeArticulationPoints from './articulation-points';\nimport { dist, findMaxEntry, radiansToDegrees } from '../utils';\nimport strokeLength from './stroke-length';\n\n/**\n * @param {Point[]} points - A list of points.\n * @return {Segment[]} The list of segments joining the points of `points`.\n */\nexport const pointsToSegments = (points) =>\n  points.slice(1).reduce(\n    ({ segments, last }, current) => {\n      segments.push([last, current]);\n      return { segments, last: current };\n    },\n    { last: points[0], segments: [] }\n  ).segments;\n\n/**\n * @param {Item} model - The marking menu model.\n * @param {{ angle }[]} segments - A list of segments to walk the model.\n * @param {number} [startIndex=0] - The start index in the angle list.\n * @return {Item} The corresponding item found by walking the model.\n */\nexport const walkMMModel = (model, segments, startIndex = 0) => {\n  if (!model || segments.length === 0 || model.isLeaf()) return null;\n  const item = model.getNearestChild(segments[startIndex].angle);\n  if (startIndex + 1 >= segments.length) {\n    return item;\n  }\n  return walkMMModel(item, segments, startIndex + 1);\n};\n\nexport const segmentAngle = (a, b) =>\n  radiansToDegrees(Math.atan2(b[1] - a[1], b[0] - a[0]));\n\n/**\n * @param {{angle, length}[]} segments - A list of segments.\n * @return {{angle, length}[]} A new list of segments with the longest segments divided in two.\n */\nexport const divideLongestSegment = (segments) => {\n  const [longestI, longest] = findMaxEntry(\n    segments,\n    (s1, s2) => s2.length - s1.length\n  );\n  return [\n    ...segments.slice(0, longestI),\n    { length: longest.length / 2, angle: longest.angle },\n    { length: longest.length / 2, angle: longest.angle },\n    ...segments.slice(longestI + 1),\n  ];\n};\n\n/**\n * @param {Item} model - The marking menu model.\n * @param {{length, angle}[]} segments - A list of segments.\n * @param {number} [maxDepth=model.getMaxDepth()] - The maximum depth of the item.\n * @return {Item} The selected item.\n */\nexport const findMMItem = (model, segments, maxDepth = model.getMaxDepth()) => {\n  // If there is not segments, there is no selection to find.\n  if (!segments.length) return null;\n  // While we haven't found a leaf item, divide the longest segment and walk the model.\n  let currentSegments = segments;\n  let currentItem = null;\n  while (currentSegments.length <= maxDepth) {\n    currentItem = walkMMModel(model, currentSegments);\n    if (currentItem && currentItem.isLeaf()) return currentItem;\n    currentSegments = divideLongestSegment(currentSegments);\n  }\n  return currentItem;\n};\n\n/**\n * @param {List.<number[]>} stroke - A list of points.\n * @param {Item} model - The marking menu model.\n * @param {object} [options] - Additional options.\n * @param {number} [maxDepth] - The maximum menu depth to walk. If negative,\n * start from the maximum depth of the model.\n * @param {boolean} [requireMenu=false] - Look for a menu item. This\n * works best with a negative value for maxDepth.\n * @param {boolean} [requireLeaf=!requireMenu] - Look for a leaf.\n * @return {Item} The item recognized by the stroke.\n */\nconst recognizeMMStroke = (\n  stroke,\n  model,\n  {\n    maxDepth: maxDepth_ = model.getMaxDepth(),\n    requireMenu = false,\n    requireLeaf = !requireMenu,\n  } = {}\n) => {\n  if (requireLeaf && requireMenu) {\n    throw new Error('The result cannot be both a leaf and a menu');\n  }\n  const maxDepth = maxDepth_ < 0 ? model.getMaxDepth() + maxDepth_ : maxDepth_;\n  const maxMenuBreadth = model.getMaxBreadth();\n  const length = strokeLength(stroke);\n  const expectedSegmentLength = length / maxDepth;\n  const sensitivity = 0.75;\n  const angleThreshold = 360 / maxMenuBreadth / 2 / sensitivity;\n  const articulationPoints = getStrokeArticulationPoints(\n    stroke,\n    expectedSegmentLength,\n    angleThreshold\n  );\n  const minSegmentSize = expectedSegmentLength / 3;\n  // Get the segments of the marking menus.\n  const segments = pointsToSegments(articulationPoints)\n    // Change the representation of the segment to include its length.\n    .map((seg) => ({ points: seg, length: dist(...seg) }))\n    // Remove the segments that are too small.\n    .filter((seg) => seg.length > minSegmentSize)\n    // Change again the representation of the segment to include its length but not its\n    // its points anymore.\n    .map((seg) => ({ angle: segmentAngle(...seg.points), length: seg.length }));\n  const item = findMMItem(model, segments, maxDepth);\n  if (requireLeaf) {\n    return item && item.isLeaf() ? item : null;\n  }\n  if (requireMenu) {\n    return item && item.isLeaf() ? item.parent : item;\n  }\n  return item;\n};\n\nexport default recognizeMMStroke;\n","import { merge } from 'rxjs';\nimport { startWith, last, map, share } from 'rxjs/operators';\nimport { draw } from '../move';\nimport recognize from '../recognizer';\n\n/**\n * @param {Observable} drag$ - An observable of drag movements.\n * @param {MMItem} model - The model of the menu.\n * @param {List<number[]>} initStroke - Initial stroke.\n * @return {Observable} An observable on the gesture drawing and recognition.\n */\nexport default (drag$, model, initStroke = []) => {\n  // Observable on gesture drawing.\n  const draw$ = draw(drag$, { initStroke, type: 'draw' }).pipe(share());\n\n  // Track the end of the drawing and attempt to recognize the gesture.\n  const end$ = draw$.pipe(\n    startWith(null),\n    last(),\n    map((e) => {\n      if (!e) return { type: 'cancel' };\n      const selection = recognize(e.stroke, model);\n      if (selection) {\n        return { ...e, type: 'select', selection };\n      }\n      return { ...e, type: 'cancel' };\n    })\n  );\n  return merge(draw$, end$);\n};\n","import { race, of } from 'rxjs';\nimport {\n  take,\n  map,\n  skip,\n  startWith,\n  switchAll,\n  mergeMap,\n  exhaustMap,\n} from 'rxjs/operators';\nimport noviceNavigation from './novice-navigation';\nimport expertNavigation from './expert-navigation';\nimport { longMoves, dwellings, draw } from '../move';\nimport recognize from '../recognizer';\n\nexport const confirmedNoviceNavigationHOO = (drag$, start, model, options) =>\n  dwellings(drag$, options.noviceDwellingTime, options.movementsThreshold).pipe(\n    take(1),\n    map(() =>\n      (start != null ? of(start) : drag$).pipe(\n        take(1),\n        mergeMap((start_) =>\n          noviceNavigation(\n            // Same as before, skip the first.\n            drag$.pipe(skip(1)),\n            model,\n            { ...options, menuCenter: start_.position }\n          ).pipe(map((n) => ({ ...n, mode: 'novice' })))\n        )\n      )\n    )\n  );\n\nexport const expertToNoviceSwitchHOO = (drag$, model, initStroke, options) =>\n  dwellings(\n    draw(drag$, { initStroke }),\n    options.noviceDwellingTime,\n    options.movementsThreshold\n  ).pipe(\n    take(1),\n    map((evt) => {\n      // Look for the furthest menu (not leaf).\n      const menu = recognize(evt.stroke, model, {\n        maxDepth: -1,\n        requireMenu: true,\n      });\n      if (!menu || menu.isRoot()) {\n        return of({ ...evt, type: 'cancel' });\n      }\n      // Start a novice navigation from there.\n      return noviceNavigation(drag$.pipe(skip(1)), menu, {\n        ...options,\n        menuCenter: evt.position,\n      });\n    })\n  );\n\nexport const confirmedExpertNavigationHOO = (\n  drag$,\n  model,\n  {\n    expertToNoviceSwitchHOO: expertToNoviceSwitchHOO_ = expertToNoviceSwitchHOO,\n    ...options\n  } = {}\n) =>\n  longMoves(draw(drag$, { type: 'draw' }), options.movementsThreshold).pipe(\n    take(1),\n    map((e) => {\n      const expertNav$ = expertNavigation(\n        // Drag always return the last value when observed, in this case we are\n        // not interested in it as it has already been took into account.\n        drag$.pipe(skip(1)),\n        model,\n        e.stroke\n      ).pipe(map((n) => ({ ...n, mode: 'expert' })));\n      return expertToNoviceSwitchHOO_(drag$, model, e.stroke, options).pipe(\n        startWith(expertNav$),\n        switchAll()\n      );\n    })\n  );\n\nexport const startup = (drag$, model) =>\n  expertNavigation(drag$, model).pipe(\n    map((n, i) =>\n      i === 0\n        ? { ...n, type: 'start', mode: 'startup' }\n        : { ...n, mode: 'startup' }\n    )\n  );\n\nexport const navigationFromDrag = (\n  drag$,\n  start,\n  model,\n  options,\n  {\n    confirmedExpertNavigationHOO:\n      confirmedExpertNavigationHOO_ = confirmedExpertNavigationHOO,\n    confirmedNoviceNavigationHOO:\n      confirmedNoviceNavigationHOO_ = confirmedNoviceNavigationHOO,\n    startup: startup_ = startup,\n  } = {}\n) => {\n  // Start up observable (while neither expert or novice are confirmed).\n  const startUp$ = startup_(drag$, model);\n\n  // Observable on confirmed expert navigation.\n  const confirmedExpertNavigation$$ = confirmedExpertNavigationHOO_(\n    drag$,\n    model,\n    options\n  );\n\n  // Observable on confirmed novice navigation.\n  const confirmedNoviceNavigation$$ = confirmedNoviceNavigationHOO_(\n    drag$,\n    start,\n    model,\n    options\n  );\n\n  // Observable on expert or novice navigation once confirmed.\n  const confirmedNavigation$$ = race(\n    confirmedExpertNavigation$$,\n    confirmedNoviceNavigation$$\n  );\n\n  // Start with startup navigation (similar to expert) but switch to the\n  // confirmed navigation as soon as it is settled.\n  return confirmedNavigation$$.pipe(startWith(startUp$), switchAll());\n};\n\n/**\n * @param {Observable} drags$ - A higher order observable on drag movements.\n * @param {MMItem} menu - The model of the menu.\n * @param {object} options - Configuration options (see {@link ../index.js}).\n * @param {function} [navigationFromDrag_] - function to convert a drags higher\n *                                         order observable to a navigation\n *                                         observable.\n * @return {Observable} An observable on the marking menu events.\n */\nexport default (\n  drags$,\n  menu,\n  options,\n  navigationFromDrag_ = navigationFromDrag\n) =>\n  drags$.pipe(\n    exhaustMap((drag$) =>\n      drag$.pipe(\n        take(1),\n        mergeMap((start) => navigationFromDrag_(drag$, start, menu, options))\n      )\n    )\n  );\n","function styleInject(css, ref) {\n  if ( ref === void 0 ) ref = {};\n  var insertAt = ref.insertAt;\n\n  if (!css || typeof document === 'undefined') { return; }\n\n  var head = document.head || document.getElementsByTagName('head')[0];\n  var style = document.createElement('style');\n  style.type = 'text/css';\n\n  if (insertAt === 'top') {\n    if (head.firstChild) {\n      head.insertBefore(style, head.firstChild);\n    } else {\n      head.appendChild(style);\n    }\n  } else {\n    head.appendChild(style);\n  }\n\n  if (style.styleSheet) {\n    style.styleSheet.cssText = css;\n  } else {\n    style.appendChild(document.createTextNode(css));\n  }\n}\n\nexport default styleInject;\n","import { degreesToRadians } from '../utils';\nimport './menu.css';\n\nconst template = ({ items, center }, doc) => {\n  const main = doc.createElement('div');\n  main.className = 'marking-menu';\n  main.style.setProperty('--center-x', `${center[0]}px`);\n  main.style.setProperty('--center-y', `${center[1]}px`);\n  for (let i = 0; i < items.length; i += 1) {\n    const item = items[i];\n    const elt = doc.createElement('div');\n    elt.className = 'marking-menu-item';\n    elt.dataset.itemId = item.id;\n    elt.style.setProperty('--angle', `${item.angle}deg`);\n    // Identify corner items as these may be styled differently.\n    if (item.angle === 45) {\n      elt.classList.add('bottom-right-item');\n    } else if (item.angle === 135) {\n      elt.classList.add('bottom-left-item');\n    } else if (item.angle === 225) {\n      elt.classList.add('top-left-item');\n    } else if (item.angle === 315) {\n      elt.classList.add('top-right-item');\n    }\n    const radAngle = degreesToRadians(item.angle);\n    // Why -radAngle? I got the css math wrong at some point, but it works like\n    // this and I could not be bothered fixing it.\n    elt.style.setProperty('--cosine', Math.cos(-radAngle));\n    elt.style.setProperty('--sine', Math.sin(-radAngle));\n    elt.innerHTML += '<div class=\"marking-menu-line\"></div>';\n    elt.innerHTML += `<div class=\"marking-menu-label\">${item.name}</div>`;\n    main.appendChild(elt);\n  }\n\n  return main;\n};\n\n/**\n * Create the Menu display.\n * @param {HTMLElement} parent - The parent node.\n * @param {ItemModel} model - The model of the menu to open.\n * @param {[int, int]} center - The center of the menu.\n * @param {String} [current] - The currently active item.\n * @param {Document} [options] - Menu options.\n * @param {Document} [options.doc=document] - The root document of the menu.\n *                                            Mostly useful for testing purposes.\n * @return {{ setActive, remove }} - The menu controls.\n */\nconst createMenu = (\n  parent,\n  model,\n  center,\n  current,\n  { doc = document } = {}\n) => {\n  // Create the DOM.\n  const main = template({ items: model.children, center }, doc);\n  parent.appendChild(main);\n\n  // Clear any  active items.\n  const clearActiveItems = () => {\n    Array.from(main.querySelectorAll('.active')).forEach((itemDom) =>\n      itemDom.classList.remove('active')\n    );\n  };\n\n  // Return an item DOM element from its id.\n  const getItemDom = (itemId) =>\n    main.querySelector(`.marking-menu-item[data-item-id=\"${itemId}\"]`);\n\n  // Mark an item as active.\n  const setActive = (itemId) => {\n    // Clear any  active items.\n    clearActiveItems();\n\n    // Set the active class.\n    if (itemId || itemId === 0) {\n      getItemDom(itemId).classList.add('active');\n    }\n  };\n\n  // Function to remove the menu.\n  const remove = () => parent.removeChild(main);\n\n  // Initialize the menu.\n  if (current) setActive(current);\n\n  // Create the interface.\n  return { setActive, remove };\n};\n\nexport default createMenu;\n","/**\n * @param {HTMLElement} parent - The parent node.\n * @param {Document} options - Options.\n * @param {Document} [options.doc=document] - The root document. Mostly useful for testing purposes.\n * @param {number} [options.lineWidth=2] - The width of the stroke.\n * @param {string} [options.lineColor='black'] - CSS representation of the stroke color.\n * @param {number} [options.startPointRadius=0] - The radius of the start point.\n * @param {number} [options.startPointColor=options.lineColor] - CSS representation of the start\n *                                                               point color.\n * @param {number} [options.ptSize=1 / devicePixelRatio] - The size of the canvas points\n *                                                         (px).\n * @return {{ clear, setStroke, remove }} The canvas methods.\n */\nexport default (\n  parent,\n  {\n    doc = document,\n    lineWidth = 2,\n    lineColor = 'black',\n    pointRadius = 0,\n    pointColor = lineColor,\n    ptSize = window.devicePixelRatio ? 1 / window.devicePixelRatio : 1,\n  }\n) => {\n  // Create the canvas.\n  const { width, height } = parent.getBoundingClientRect();\n  const canvas = doc.createElement('canvas');\n  canvas.width = width / ptSize;\n  canvas.height = height / ptSize;\n  Object.assign(canvas.style, {\n    position: 'absolute',\n    left: 0,\n    top: 0,\n    width: `${width}px`,\n    height: `${height}px`,\n    'pointer-events': 'none',\n  });\n  parent.appendChild(canvas);\n\n  // Get the canvas' context and set it up\n  const ctx = canvas.getContext('2d');\n  // Scale to the device pixel ratio.\n  ctx.scale(1 / ptSize, 1 / ptSize);\n\n  /**\n   * @param {number[]} point - Position of the point to draw.\n   * @return {undefined}\n   */\n  const drawPoint = ([x, y]) => {\n    ctx.save();\n    ctx.strokeStyle = 'none';\n    ctx.fillStyle = pointColor;\n    ctx.beginPath();\n    ctx.moveTo(x + pointRadius, y);\n    ctx.arc(x, y, pointRadius, 0, 360);\n    ctx.fill();\n    ctx.restore();\n  };\n\n  /**\n   * Clear the canvas.\n   *\n   * @return {undefined}\n   */\n  const clear = () => {\n    ctx.clearRect(0, 0, width, height);\n  };\n\n  /**\n   * Draw the stroke.\n   *\n   * @param {List<number[]>} stroke - The new stroke.\n   * @return {undefined}\n   */\n  const drawStroke = (stroke) => {\n    ctx.save();\n    ctx.fillStyle = 'none';\n    ctx.lineJoin = 'round';\n    ctx.lineCap = 'round';\n    ctx.strokeStyle = lineColor;\n    ctx.lineWidth = lineWidth;\n    ctx.beginPath();\n    stroke.forEach((point, i) => {\n      if (i === 0) ctx.moveTo(...point);\n      else ctx.lineTo(...point);\n    });\n    ctx.stroke();\n    ctx.restore();\n  };\n\n  /**\n   * Destroy the canvas.\n   * @return {undefined}\n   */\n  const remove = () => {\n    canvas.remove();\n  };\n\n  return { clear, drawStroke, drawPoint, remove };\n};\n","var rafSchd = function rafSchd(fn) {\n  var lastArgs = [];\n  var frameId = null;\n\n  var wrapperFn = function wrapperFn() {\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    lastArgs = args;\n\n    if (frameId) {\n      return;\n    }\n\n    frameId = requestAnimationFrame(function () {\n      frameId = null;\n      fn.apply(void 0, lastArgs);\n    });\n  };\n\n  wrapperFn.cancel = function () {\n    if (!frameId) {\n      return;\n    }\n\n    cancelAnimationFrame(frameId);\n    frameId = null;\n  };\n\n  return wrapperFn;\n};\n\nexport default rafSchd;\n","import { finalize, tap } from 'rxjs/operators';\nimport rafThrottle from 'raf-schd';\n\n/**\n * Connect navigation notifications to menu opening and closing.\n *\n * @param {HTMLElement} parentDOM - The element where to append the menu.\n * @param {Observable} navigation$ - Notifications of the navigation.\n * @param {Function} createMenuLayout - Menu layout factory.\n * @param {Function} createUpperStrokeCanvas - Upper stroke canvas factory. The\n * upper stroke show the user interaction on the current menu, and the movements\n * in expert mode.\n * @param {Function} createLowerStrokeCanvas - Lower stroke canvas factory. The\n * lower stroke is stroke drawn below the menu. It keeps track of the previous\n * movements.\n * @param {Function} createGestureFeedback - Create gesture feedback.\n * @param {{error}} log - Logger.\n * @return {Observable} `navigation$` with menu opening and closing side effects.\n */\nexport default (\n  parentDOM,\n  navigation$,\n  createMenuLayout,\n  createUpperStrokeCanvas,\n  createLowerStrokeCanvas,\n  createGestureFeedback,\n  log\n) => {\n  // The menu object.\n  let menu = null;\n  // A stroke drawn on top of the menu.\n  let upperStrokeCanvas = null;\n  // A stroke drawn below the menu.\n  let lowerStrokeCanvas = null;\n  // The points of the lower strokes.\n  let lowerStroke = null;\n  // The points of the upper stroke.\n  let upperStroke = null;\n\n  const gestureFeedback = createGestureFeedback(parentDOM);\n\n  const closeMenu = () => {\n    menu.remove();\n    menu = null;\n  };\n\n  const openMenu = (model, position) => {\n    const cbr = parentDOM.getBoundingClientRect();\n    menu = createMenuLayout(parentDOM, model, [\n      position[0] - cbr.left,\n      position[1] - cbr.top,\n    ]);\n  };\n\n  const setActive = (id) => {\n    menu.setActive(id);\n  };\n\n  const startUpperStroke = (position) => {\n    upperStrokeCanvas = createUpperStrokeCanvas(parentDOM);\n    upperStroke = [position];\n    upperStrokeCanvas.drawStroke(upperStroke);\n  };\n\n  const noviceMove = rafThrottle((position) => {\n    if (upperStrokeCanvas) {\n      upperStrokeCanvas.clear();\n      if (position) {\n        upperStroke = [upperStroke[0], position];\n        upperStrokeCanvas.drawStroke(upperStroke);\n      }\n      upperStrokeCanvas.drawPoint(upperStroke[0]);\n    }\n  });\n\n  const expertDraw = rafThrottle((stroke) => {\n    // FIXME: Not very efficient.\n    if (upperStrokeCanvas) {\n      upperStrokeCanvas.clear();\n      upperStroke = stroke.slice();\n      upperStrokeCanvas.drawStroke(upperStroke);\n    }\n  });\n\n  const clearUpperStroke = () => {\n    upperStrokeCanvas.remove();\n    upperStrokeCanvas = null;\n    upperStroke = null;\n  };\n\n  const swapUpperStroke = () => {\n    lowerStroke = lowerStroke ? [...lowerStroke, ...upperStroke] : upperStroke;\n    clearUpperStroke();\n    lowerStrokeCanvas = lowerStrokeCanvas || createLowerStrokeCanvas(parentDOM);\n    lowerStrokeCanvas.drawStroke(lowerStroke);\n  };\n\n  const clearLowerStroke = () => {\n    if (lowerStrokeCanvas) {\n      lowerStrokeCanvas.remove();\n      lowerStrokeCanvas = null;\n    }\n    lowerStroke = null;\n  };\n\n  const showGestureFeedback = (isCanceled) => {\n    gestureFeedback.show(\n      lowerStroke ? [...lowerStroke, ...upperStroke] : upperStroke,\n      isCanceled\n    );\n  };\n\n  const cleanUp = () => {\n    // Make sure everything is cleaned upon completion.\n    if (menu) closeMenu();\n    if (upperStrokeCanvas) clearUpperStroke();\n    if (lowerStrokeCanvas) clearLowerStroke();\n    gestureFeedback.remove();\n    // eslint-disable-next-line no-param-reassign\n    parentDOM.style.cursor = '';\n  };\n\n  const onNotification = (notification) => {\n    switch (notification.type) {\n      case 'open': {\n        // eslint-disable-next-line no-param-reassign\n        parentDOM.style.cursor = 'none';\n        if (menu) closeMenu();\n        swapUpperStroke();\n        openMenu(notification.menu, notification.center);\n        startUpperStroke(notification.center);\n        noviceMove(notification.position);\n        break;\n      }\n      case 'change': {\n        setActive((notification.active && notification.active.id) || null);\n        break;\n      }\n      case 'select':\n      case 'cancel':\n        // eslint-disable-next-line no-param-reassign\n        parentDOM.style.cursor = '';\n        if (menu) closeMenu();\n        showGestureFeedback(notification.type === 'cancel');\n        clearUpperStroke();\n        clearLowerStroke();\n        break;\n      case 'start':\n        // eslint-disable-next-line no-param-reassign\n        parentDOM.style.cursor = 'crosshair';\n        startUpperStroke(notification.position);\n        break;\n      case 'draw':\n        expertDraw(notification.stroke);\n        break;\n      case 'move':\n        noviceMove(notification.position);\n        break;\n      default:\n        throw new Error(\n          `Invalid navigation notification type: ${notification.type}`\n        );\n    }\n  };\n\n  return navigation$.pipe(\n    tap({\n      next(notification) {\n        try {\n          onNotification(notification);\n        } catch (e) {\n          log.error(e);\n          throw e;\n        }\n      },\n      error(e) {\n        log.error(e);\n        throw e;\n      },\n    }),\n    finalize(() => {\n      try {\n        cleanUp();\n      } catch (e) {\n        log.error(e);\n        throw e;\n      }\n    })\n  );\n};\n","import createStrokeCanvas from './stroke';\n\nexport default (\n  parentDOM,\n  { duration, strokeOptions = {}, canceledStrokeOptions = {} }\n) => {\n  let strokeTimeoutEntries = [];\n\n  const show = (stroke, isCanceled = false) => {\n    const canvas = createStrokeCanvas(parentDOM, {\n      ...strokeOptions,\n      ...(isCanceled ? canceledStrokeOptions : {}),\n    });\n    canvas.drawStroke(stroke);\n    const timeoutEntry = {\n      canvas,\n      timeout: setTimeout(() => {\n        // Remove the entry from the strokeTimeoutEntries.\n        strokeTimeoutEntries = strokeTimeoutEntries.filter(\n          (x) => x !== timeoutEntry\n        );\n        // Clear the stroke canvas.\n        canvas.remove();\n      }, duration),\n    };\n    strokeTimeoutEntries.push(timeoutEntry);\n  };\n\n  const remove = () => {\n    strokeTimeoutEntries.forEach(({ timeout, canvas }) => {\n      clearTimeout(timeout);\n      canvas.remove();\n    });\n    strokeTimeoutEntries = [];\n  };\n\n  return { show, remove };\n};\n","import { deltaAngle } from './utils';\n\nconst getAngleRange = (items) => (items.length > 4 ? 45 : 90);\n\n/**\n * Represents an item of the Marking Menu.\n */\nexport class MMItem {\n  /**\n   * @param {String} id - The item's id. Required except for the root item.\n   * @param {String} name - The item's name. Required except for the root item.\n   * @param {Integer} angle - The item's angle. Required except for the root item.\n   * @param {object} [options] - Some additional options.\n   * @param {ItemModel} [options.parent] - The parent menu of the item.\n   * @param {List<ItemModel>} [options.children] - The children of the item menu.\n   */\n  constructor(id, name, angle, { parent, children } = {}) {\n    this.id = id;\n    this.name = name;\n    this.angle = angle;\n    this.children = children;\n    this.parent = parent;\n  }\n\n  isLeaf() {\n    return !this.children || this.children.length === 0;\n  }\n\n  isRoot() {\n    return !this.parent;\n  }\n\n  /**\n   * @param {String} childId - The identifier of the child to look for.\n   * @return {Item} the children with the id `childId`.\n   */\n  getChild(childId) {\n    return this.children.find((child) => child.id === childId);\n  }\n\n  /**\n   * @param {String} childName - The name of the children to look for.\n   * @return {Item} the children with the name `childName`.\n   */\n  getChildrenByName(childName) {\n    return this.children.filter((child) => child.name === childName);\n  }\n\n  /**\n   * @param {Integer} angle - An angle.\n   * @return {Item} the closest children to the angle `angle`.\n   */\n  getNearestChild(angle) {\n    return this.children.reduce((c1, c2) => {\n      const delta1 = Math.abs(deltaAngle(c1.angle, angle));\n      const delta2 = Math.abs(deltaAngle(c2.angle, angle));\n      return delta1 > delta2 ? c2 : c1;\n    });\n  }\n\n  /**\n   * @return {number} The maximum depth of the menu.\n   */\n  getMaxDepth() {\n    return this.isLeaf()\n      ? 0\n      : Math.max(0, ...this.children.map((child) => child.getMaxDepth())) + 1;\n  }\n\n  /**\n   * @return {number} The maximum breadth of the menu.\n   */\n  getMaxBreadth() {\n    return this.isLeaf()\n      ? 0\n      : Math.max(\n          this.children.length,\n          ...this.children.map((child) => child.getMaxBreadth())\n        );\n  }\n}\n\n// Create the model item from a list of items.\nconst recursivelyCreateModelItems = (\n  items,\n  baseId = undefined,\n  parent = undefined\n) => {\n  // Calculate the angle range for each items.\n  const angleRange = getAngleRange(items);\n  // Create the list of model items (frozen).\n  return Object.freeze(\n    items.map((item, i) => {\n      // Standard item id.\n      const stdId = baseId ? [baseId, i].join('-') : i.toString();\n      // Create the item.\n      const mmItem = new MMItem(\n        item.id == null ? stdId : item.id,\n        typeof item === 'string' ? item : item.name,\n        i * angleRange,\n        { parent }\n      );\n      // Add its children if any.\n      if (item.children) {\n        mmItem.children = recursivelyCreateModelItems(\n          item.children,\n          stdId,\n          mmItem\n        );\n      }\n      // Return it frozen.\n      return Object.freeze(mmItem);\n    })\n  );\n};\n\n/**\n * Create the marking menu model.\n *\n * @param {List<String|{name,children}>} itemList - The list of items.\n * @return {MMItem} - The root item of the model.\n */\nconst createModel = (itemList) => {\n  const menu = new MMItem(null, null, null);\n  menu.children = recursivelyCreateModelItems(itemList, undefined, menu);\n  return Object.freeze(menu);\n};\n\nexport default createModel;\n","import { tap, map, share, filter, pluck } from 'rxjs/operators';\nimport navigation from './navigation';\nimport {\n  createMenuLayout,\n  createStrokeCanvas,\n  connectLayout,\n  createGestureFeedback,\n} from './layout';\nimport createModel from './model';\nimport { watchDrags } from './move';\n\n// Clone a notification in a protected way so that the internal state cannot be corrupted.\nexport const exportNotification = (n) => ({\n  type: n.type,\n  mode: n.mode,\n  position: n.position ? n.position.slice() : undefined,\n  active: n.active,\n  selection: n.selection,\n  menuCenter: n.center ? n.center.slice() : undefined,\n  timeStamp: n.timeStamp,\n});\n\n/**\n * Create a Marking Menu.\n *\n * @param {List<String|{name,children}>} items - The list of items.\n * @param {HTMLElement} parentDOM - The parent node.\n * @param {Object} [options] - Configuration options for the menu.\n * @param {number} [options.minSelectionDist] - The minimum distance from the center to select an\n *                                              item.\n * @param {number} [options.minMenuSelectionDist] - The minimum distance from the center to open a\n *                                                  sub-menu.\n * @param {number} [options.subMenuOpeningDelay] - The dwelling delay before opening a sub-menu.\n * @param {number} [options.movementsThreshold] - The minimum distance between two points to be\n *                                                considered a significant movements and breaking\n *                                                the sub-menu dwelling delay.\n * @param {number} [options.noviceDwellingTime] - The dwelling time required to trigger the novice\n *                                                mode (and open the menu).\n * @param {number} [options.strokeColor] - The color of the gesture stroke.\n * @param {number} [options.strokeWidth] - The width of the gesture stroke.\n * @param {number} [options.strokeStartPointRadius] - The radius of the start point of the stroke\n *                                                    (appearing at the middle of the menu in novice\n *                                                    mode).\n * @param {number} [options.lowerStrokeColor] - The color of the lower stroke. The lower stroke is\n *                                              the stroke drawn below the menu. It keeps track of\n *                                              the previous movements.\n * @param {number} [options.lowerStrokeWidth] - The width of the lower stroke.\n * @param {number} [options.lowerStrokeStartPointRadius] - The radius of the start point of the\n *                                                         stroke.\n * @param {number} [options.gestureFeedbackStrokeWidth] - The width of the stroke of the gesture\n *                                                        feedback.\n * @param {number} [options.gestureFeedbackStrokeColor] - The color of the stroke of the gesture\n *                                                        feedback.\n * @param {number} [options.gestureFeedbackCanceledStrokeColor] - The color of the stroke of the\n *                                                        gesture feedback when the selection is\n *                                                        canceled.\n * @param {number} [options.gestureFeedbackDuration] - The duration of the gesture feedback.\n * @param {boolean} [options.notifySteps] - If true, every steps of the marking menu (include move)\n *                                          events, will be notified. Useful for logging.\n * @param {{error, info, warn, debug}} [options.log] - Override the default logger to use.\n * @return {Observable} An observable on menu selections.\n */\nexport default (\n  items,\n  parentDOM,\n  {\n    minSelectionDist = 40,\n    minMenuSelectionDist = 80,\n    subMenuOpeningDelay = 100,\n    movementsThreshold = 5,\n    noviceDwellingTime = 1000 / 3,\n    strokeColor = '#000',\n    strokeWidth = 4,\n    strokeStartPointRadius = 8,\n    lowerStrokeColor = '#777',\n    lowerStrokeWidth = strokeWidth,\n    lowerStrokeStartPointRadius = lowerStrokeWidth,\n    gestureFeedbackDuration = 1000,\n    gestureFeedbackStrokeWidth = strokeWidth,\n    gestureFeedbackCanceledStrokeColor = '#DE6C52',\n    gestureFeedbackStrokeColor = strokeColor,\n    notifySteps = false,\n    log = {\n      // eslint-disable-next-line no-console\n      error: console.error && console.error.bind(console),\n      // eslint-disable-next-line no-console\n      info: console.info && console.info.bind(console),\n      // eslint-disable-next-line no-console\n      warn: console.warn && console.warn.bind(console),\n      debug() {},\n    },\n  } = {}\n) => {\n  // Create the display options\n  const menuLayoutOptions = {};\n  const strokeCanvasOptions = {\n    lineColor: strokeColor,\n    lineWidth: strokeWidth,\n    pointRadius: strokeStartPointRadius,\n  };\n  const lowerStrokeCanvasOptions = {\n    lineColor: lowerStrokeColor,\n    lineWidth: lowerStrokeWidth,\n    pointRadius: lowerStrokeStartPointRadius,\n  };\n  const gestureFeedbackOptions = {\n    duration: gestureFeedbackDuration,\n    strokeOptions: {\n      lineColor: gestureFeedbackStrokeColor,\n      lineWidth: gestureFeedbackStrokeWidth,\n    },\n    canceledStrokeOptions: {\n      lineColor: gestureFeedbackCanceledStrokeColor,\n    },\n  };\n\n  // Create model and navigation observable.\n  const model = createModel(items);\n  const navigation$ = navigation(watchDrags(parentDOM), model, {\n    minSelectionDist,\n    minMenuSelectionDist,\n    subMenuOpeningDelay,\n    movementsThreshold,\n    noviceDwellingTime,\n  }).pipe(\n    tap(({ originalEvent }) => {\n      // Prevent default on every notifications.\n      if (originalEvent) originalEvent.preventDefault();\n    })\n  );\n\n  // Connect the engine's notifications to menu opening/closing.\n  const connectedNavigation$ = connectLayout(\n    parentDOM,\n    navigation$,\n    (parent, menuModel, center, current) =>\n      createMenuLayout(parent, menuModel, center, current, menuLayoutOptions),\n    (parent) => createStrokeCanvas(parent, strokeCanvasOptions),\n    (parent) => createStrokeCanvas(parent, lowerStrokeCanvasOptions),\n    (parent) => createGestureFeedback(parent, gestureFeedbackOptions),\n    log\n  );\n\n  // If every steps should be notified, just export connectedNavigation$.\n  if (notifySteps) {\n    return connectedNavigation$.pipe(map(exportNotification), share());\n  }\n  // Else, return an observable on the selections.\n  return connectedNavigation$.pipe(\n    filter((notification) => notification.type === 'select'),\n    pluck('selection'),\n    share()\n  );\n};\n"],"names":["mod","a","n","radiansToDegrees","radians","Math","PI","degreesToRadians","degrees","deltaAngle","alpha","beta","dist","point1","point2","sum","reduce","acc","x1i","i","x2i","sqrt","ANGLE_ROUNDING","angle","b","c","lab","lbc","lac","cos","adjustedCos","max","min","angleABC","acos","round","findMaxEntry","list","comp","slice","result","item","index","toPolar","px","py","cx","cy","x","y","azymuth","atan2","radius","createPEventFromTouchEvent","touchEvt","touchList","Array","from","targetTouches","sumX","t","clientX","sumY","clientY","meanX","length","meanY","originalEvent","position","timeStamp","createPEventFromMouseEvent","mouseEvt","mouseDrags","rootDOM","fromEvent","pipe","map","downEvt","drag$","merge","of","takeUntil","publishBehavior","connect","o","touchDrags","filter","evt","firstEvent","startWith","watchDrags","dragObsFactories","f","movementsThreshold","scan","cur","prev","type","pass","delay","scheduler","undefined","first","longMoves","debounceTime","last","withLatestFrom","_","last_","initStroke","typeOpts","notification","stroke","noviceMoves","menu","menuCenter","minSelectionDist","moves$","active","getNearestChild","center","performance","now","Date","share","end$","isLeaf","selection","menuSelection","move$","subMenuOpeningDelay","minMenuSelectionDist","dwellings","subMenuNavigation","menuSelection$","subNav","navOptions","noviceNavigation","noviceMoves_","menuSelection_","subMenuNavigation_","subMenuNavigation$","take","switchAll","findNextPointFurtherThan","pointList","minDist","direction","startIndex","refPoint","step","abs","findMiddlePointForMinAngle","pointA","pointC","endIndex","minAngle","Infinity","maxAngleIndex","thisAngle","getStrokeArticulationPoints","expectedSegmentLength","angleThreshold","w","articulationPoints","ai","ci","labi","lbci","bi","push","res","current","pointsToSegments","points","segments","walkMMModel","model","segmentAngle","divideLongestSegment","longestI","longest","s1","s2","findMMItem","maxDepth","getMaxDepth","currentSegments","currentItem","recognizeMMStroke","maxDepth_","requireMenu","requireLeaf","Error","maxMenuBreadth","getMaxBreadth","strokeLength","sensitivity","minSegmentSize","seg","parent","draw$","draw","e","recognize","confirmedNoviceNavigationHOO","start","options","noviceDwellingTime","mergeMap","start_","skip","mode","expertToNoviceSwitchHOO","isRoot","confirmedExpertNavigationHOO","expertToNoviceSwitchHOO_","expertNav$","expertNavigation","startup","navigationFromDrag","confirmedExpertNavigationHOO_","confirmedNoviceNavigationHOO_","startup_","startUp$","confirmedExpertNavigation$$","confirmedNoviceNavigation$$","confirmedNavigation$$","race","drags$","navigationFromDrag_","exhaustMap","template","doc","items","main","createElement","className","style","setProperty","elt","dataset","itemId","id","classList","add","radAngle","sin","innerHTML","name","appendChild","createMenu","document","children","clearActiveItems","querySelectorAll","forEach","itemDom","remove","getItemDom","querySelector","setActive","removeChild","lineWidth","lineColor","pointRadius","pointColor","ptSize","window","devicePixelRatio","width","height","getBoundingClientRect","canvas","Object","assign","left","top","ctx","getContext","scale","drawPoint","save","strokeStyle","fillStyle","beginPath","moveTo","arc","fill","restore","clear","clearRect","drawStroke","lineJoin","lineCap","point","lineTo","parentDOM","navigation$","createMenuLayout","createUpperStrokeCanvas","createLowerStrokeCanvas","createGestureFeedback","log","upperStrokeCanvas","lowerStrokeCanvas","lowerStroke","upperStroke","gestureFeedback","closeMenu","openMenu","cbr","startUpperStroke","noviceMove","rafThrottle","expertDraw","clearUpperStroke","swapUpperStroke","clearLowerStroke","showGestureFeedback","isCanceled","show","cleanUp","cursor","onNotification","tap","next","error","finalize","duration","strokeOptions","canceledStrokeOptions","strokeTimeoutEntries","createStrokeCanvas","timeoutEntry","timeout","setTimeout","clearTimeout","getAngleRange","MMItem","constructor","getChild","childId","find","child","getChildrenByName","childName","c1","c2","delta1","delta2","recursivelyCreateModelItems","baseId","angleRange","freeze","stdId","join","toString","mmItem","createModel","itemList","exportNotification","strokeColor","strokeWidth","strokeStartPointRadius","lowerStrokeColor","lowerStrokeWidth","lowerStrokeStartPointRadius","gestureFeedbackDuration","gestureFeedbackStrokeWidth","gestureFeedbackCanceledStrokeColor","gestureFeedbackStrokeColor","notifySteps","console","bind","info","warn","debug","menuLayoutOptions","strokeCanvasOptions","lowerStrokeCanvasOptions","gestureFeedbackOptions","navigation","preventDefault","connectedNavigation$","connectLayout","menuModel","pluck"],"mappings":"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"}